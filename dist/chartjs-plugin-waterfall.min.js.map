{"version":3,"file":"chartjs-plugin-waterfall.min.js","sources":["../src/drawStepLines.js","../src/index.js"],"sourcesContent":["export default (context, datasets, options) => {\n  const stackedDatasets = _.groupBy(datasets, 'stack');\n  const newDatasets = [];\n  const getModel = dataset => dataset._meta[0].data[0]._model;\n\n  Object.keys(stackedDatasets).forEach((key) => {\n    const currentStackedDataset = stackedDatasets[key];\n    const firstRealModel = getModel(currentStackedDataset.find(x => !x.dummyStack));\n    const firstModel = getModel(currentStackedDataset[0]);\n    const lastModel = getModel(currentStackedDataset[currentStackedDataset.length - 1]);\n\n    newDatasets.push({\n      stackRightXPos: firstModel.x + (firstModel.width / 2),\n      stackLeftXPos: firstModel.x - (firstModel.width / 2),\n      stackRealBottomYPos: firstRealModel.base,\n      stackBottomYPos: firstModel.base,\n      stackTopYPos: lastModel.y,\n    });\n  });\n\n  for (let i = 0; i < newDatasets.length; i += 1) {\n    const firstDataSet = newDatasets[i];\n\n    if (i !== newDatasets.length - 1) {\n      const secondDataSet = newDatasets[i + 1];\n\n      // Needed to convert step lines to look like bars when we have floating stacks\n      if (firstDataSet.stackTopYPos === secondDataSet.stackRealBottomYPos) {\n        secondDataSet.stackTopYPos = secondDataSet.stackRealBottomYPos;\n      } else if (firstDataSet.stackRealBottomYPos === secondDataSet.stackTopYPos) {\n        firstDataSet.stackTopYPos = firstDataSet.stackRealBottomYPos;\n      }\n\n      // Gradient from top of second box to bottom of both boxes\n      const gradient = context.createLinearGradient(\n        0,\n        secondDataSet.stackTopYPos,\n        0,\n        secondDataSet.stackBottomYPos,\n      );\n\n      gradient.addColorStop(options.startColorStop, options.startColor);\n      gradient.addColorStop(options.endColorStop, options.endColor);\n\n      context.fillStyle = gradient;\n\n      context.beginPath();\n      // top right of first box\n      context.lineTo(firstDataSet.stackRightXPos, firstDataSet.stackTopYPos);\n      // top left of second box\n      context.lineTo(secondDataSet.stackLeftXPos, secondDataSet.stackTopYPos);\n      // bottom left of second box\n      context.lineTo(secondDataSet.stackLeftXPos, secondDataSet.stackBottomYPos);\n      // bottom right of first box\n      context.lineTo(firstDataSet.stackRightXPos, firstDataSet.stackBottomYPos);\n      context.fill();\n    }\n  }\n};\n","import drawStepLines from './drawStepLines';\n\nconst waterFallPlugin = {\n  beforeInit: (chart) => {\n    chart.data.datasets.forEach((dataset, i) => {\n      // Each dataset must have a unique label so we set the dummy stacks to have dummy labels\n      dataset.label = !dataset.label ? `dummyStack_${i}` : dataset.label;\n      dataset.backgroundColor = dataset.dummyStack ? 'rgba(0, 0, 0, 0)' : dataset.backgroundColor;\n    });\n  },\n  afterDraw: (chart) => {\n    const options = chart.options.plugins.waterFallPlugin;\n    if (options.stepLines.enabled) {\n      drawStepLines(chart.ctx, chart.data.datasets, options.stepLines);\n    }\n\n    chart.update();\n  },\n};\n\nexport default waterFallPlugin;\n"],"names":["context","datasets","options","stackedDatasets","_","groupBy","newDatasets","getModel","dataset","_meta","data","_model","keys","forEach","key","currentStackedDataset","firstRealModel","find","x","dummyStack","firstModel","lastModel","length","push","width","base","y","i","firstDataSet","secondDataSet","stackTopYPos","stackRealBottomYPos","gradient","createLinearGradient","stackBottomYPos","addColorStop","startColorStop","startColor","endColorStop","endColor","fillStyle","beginPath","lineTo","stackRightXPos","stackLeftXPos","fill","chart","label","backgroundColor","plugins","waterFallPlugin","stepLines","enabled","ctx","update"],"mappings":"mMAAA,eAAgBA,EAASC,EAAUC,OAC3BC,EAAkBC,EAAEC,QAAQJ,EAAU,SACtCK,KACAC,EAAW,mBAAWC,EAAQC,MAAM,GAAGC,KAAK,GAAGC,eAE9CC,KAAKT,GAAiBU,QAAQ,SAACC,OAC9BC,EAAwBZ,EAAgBW,GACxCE,EAAiBT,EAASQ,EAAsBE,KAAK,mBAAMC,EAAEC,cAC7DC,EAAab,EAASQ,EAAsB,IAC5CM,EAAYd,EAASQ,EAAsBA,EAAsBO,OAAS,MAEpEC,qBACMH,EAAWF,EAAKE,EAAWI,MAAQ,gBACpCJ,EAAWF,EAAKE,EAAWI,MAAQ,sBAC7BR,EAAeS,qBACnBL,EAAWK,kBACdJ,EAAUK,UAIvB,IAAIC,EAAI,EAAGA,EAAIrB,EAAYgB,OAAQK,GAAK,EAAG,KACxCC,EAAetB,EAAYqB,MAE7BA,IAAMrB,EAAYgB,OAAS,EAAG,KAC1BO,EAAgBvB,EAAYqB,EAAI,GAGlCC,EAAaE,eAAiBD,EAAcE,sBAChCD,aAAeD,EAAcE,oBAClCH,EAAaG,sBAAwBF,EAAcC,iBAC/CA,aAAeF,EAAaG,yBAIrCC,EAAWhC,EAAQiC,qBACvB,EACAJ,EAAcC,aACd,EACAD,EAAcK,mBAGPC,aAAajC,EAAQkC,eAAgBlC,EAAQmC,cAC7CF,aAAajC,EAAQoC,aAAcpC,EAAQqC,YAE5CC,UAAYR,IAEZS,cAEAC,OAAOd,EAAae,eAAgBf,EAAaE,gBAEjDY,OAAOb,EAAce,cAAef,EAAcC,gBAElDY,OAAOb,EAAce,cAAef,EAAcK,mBAElDQ,OAAOd,EAAae,eAAgBf,EAAaM,mBACjDW,4BCpDA,SAACC,KACLpC,KAAKT,SAASY,QAAQ,SAACL,EAASmB,KAE5BoB,MAASvC,EAAQuC,MAA4BvC,EAAQuC,oBAAdpB,IACvCqB,gBAAkBxC,EAAQW,WAAa,mBAAqBX,EAAQwC,6BAGrE,SAACF,OACJ5C,EAAU4C,EAAM5C,QAAQ+C,QAAQC,gBAClChD,EAAQiD,UAAUC,WACNN,EAAMO,IAAKP,EAAMpC,KAAKT,SAAUC,EAAQiD,aAGlDG"}