!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o(require("lodash.merge"),require("lodash.groupby")):"function"==typeof define&&define.amd?define(["lodash.merge","lodash.groupby"],o):t.chartjsWPluginWaterfall=o(t._.merge,t._.groupby)}(this,function(t,o){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,o=o&&o.hasOwnProperty("default")?o.default:o;var a=function(t){var a=t.ctx,e=t.data.datasets,s=t.options.plugins.waterFallPlugin.stepLines,n=o(e,"stack"),r=[],i=function(t){var o=Object.keys(t._meta)[0];return t._meta[o].data[0]._model};Object.keys(n).forEach(function(t){var o=n[t],a=i(o.find(function(t){return!t.dummyStack})),e=i(o[0]),s=i(o[o.length-1]);r.push({stackRightXPos:e.x+e.width/2,stackLeftXPos:e.x-e.width/2,stackRealBottomYPos:a.base,stackBottomYPos:e.base,stackTopYPos:s.y})});for(var l=0;l<r.length;l+=1){var d=r[l];if(l!==r.length-1){var c=r[l+1];d.stackTopYPos===c.stackRealBottomYPos?c.stackTopYPos=c.stackRealBottomYPos:d.stackRealBottomYPos===c.stackTopYPos&&(d.stackTopYPos=d.stackRealBottomYPos);var u=a.createLinearGradient(0,c.stackTopYPos,0,c.stackBottomYPos);u.addColorStop(s.startColorStop,s.startColor),u.addColorStop(s.endColorStop,s.endColor),a.fillStyle=u,a.beginPath(),a.lineTo(d.stackRightXPos,d.stackTopYPos),a.lineTo(c.stackLeftXPos,c.stackTopYPos),a.lineTo(c.stackLeftXPos,c.stackBottomYPos),a.lineTo(d.stackRightXPos,d.stackBottomYPos),a.fill()}}},e={waterFallPlugin:{stepLines:{enabled:!0,startColorStop:0,endColorStop:.6,startColor:"rgba(0, 0, 0, 0.55)",endColor:"rgba(0, 0, 0, 0)"}}},s={},n=function(t,o){return!o.datasets[t.datasetIndex].dummyStack};return{beforeInit:function(t){s[t.id]={readyToDrawStepLines:!1}},afterInit:function(o){o.options.plugins=t({},e,o.options.plugins),o.options.tooltips.filter=n,o.options.legend.labels.filter=n,setTimeout(function(){s[o.id].readyToDrawStepLines=!0,a(o)},o.options.animation.duration),o.data.datasets.forEach(function(t,o){t.dummyStack&&(t.label="dummyStack_"+o,t.backgroundColor="rgba(0, 0, 0, 0)")})},afterDraw:function(t){t.options.plugins.waterFallPlugin.stepLines.enabled&&s[t.id].readyToDrawStepLines&&a(t)}}});
//# sourceMappingURL=chartjs-plugin-waterfall.min.js.map
