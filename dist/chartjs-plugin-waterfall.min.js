!function(a,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("lodash.merge"),require("lodash.groupby")):"function"==typeof define&&define.amd?define(["lodash.merge","lodash.groupby"],t):a.chartjsWPluginWaterfall=t(a._.merge,a._.groupby)}(this,function(a,t){"use strict";a=a&&a.hasOwnProperty("default")?a.default:a,t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(a,t,e,o,s){var n=s?e.stackFakeBase:e.stackBase,i=s?o.stackFakeBase:o.stackBase,l=a.createLinearGradient(0,o.stackTopYPos,0,i);l.addColorStop(t.startColorStop,t.startColor),l.addColorStop(t.endColorStop,t.endColor),a.fillStyle=l,a.beginPath(),a.lineTo(e.stackRightXPos,e.stackTopYPos),a.lineTo(o.stackLeftXPos,o.stackTopYPos),a.lineTo(o.stackLeftXPos,i),a.lineTo(e.stackRightXPos,n),a.fill()},o=function(a){var o=a.ctx,s=a.data.datasets,n=a.options.plugins.waterFallPlugin.stepLines,i=t(s,"stack"),l=[],r=function(a){var t=Object.keys(a._meta)[0];return a._meta[t].data[0]._model},c=function(a){var t=[],e=null;return a.forEach(function(a,o){var s=r(a);0===o&&(e=s.base),t.push({stackRightXPos:s.x+s.width/2,stackLeftXPos:s.x-s.width/2,stackTopYPos:s.y,stackBase:e})}),t};Object.keys(i).forEach(function(a){var t=i[a],e=t.filter(function(a){return!a.dummyStack});l.push({allDataPoints:c(t),allRealDataPoints:c(e)})});for(var u=function(a){return{stackRightXPos:a.allRealDataPoints[0].stackRightXPos,stackLeftXPos:a.allRealDataPoints[0].stackLeftXPos,stackTopYPos:a.allRealDataPoints[a.allRealDataPoints.length-1].stackTopYPos,stackBase:a.allRealDataPoints[0].stackBase,stackFakeBase:a.allDataPoints[0].stackBase}},d=function(a,t){return a.stackTopYPos===t.stackTopYPos&&a.stackFakeBase===t.stackFakeBase},p=0;p<l.length;p+=1)!function(a){var t=l[a];if(a!==l.length-1){var s=l[a+1],i=u(t),r=u(s);i.stackTopYPos===r.stackBase?r.stackTopYPos=r.stackBase:i.stackBase===r.stackTopYPos&&(i.stackTopYPos=i.stackBase),(n.diagonalStepLines||d(i,r))&&e(o,n,i,r,!0),Array.isArray(n.diagonalStepLines)&&n.diagonalStepLines.forEach(function(a){var i=a[0],l=a[1],r=t.allRealDataPoints[i],c=s.allRealDataPoints[l];r&&c&&e(o,n,r,c)})}}(p)},s={waterFallPlugin:{stepLines:{enabled:!0,startColorStop:0,endColorStop:.6,startColor:"rgba(0, 0, 0, 0.55)",endColor:"rgba(0, 0, 0, 0)",diagonalStepLines:!0}}},n={},i=function(a,t){return!t.datasets[a.datasetIndex].dummyStack};return{beforeInit:function(a){n[a.id]={readyToDrawStepLines:!1}},afterInit:function(t){t.options.plugins=a({},s,t.options.plugins),t.options.tooltips.filter=i,t.options.legend.labels.filter=i,setTimeout(function(){n[t.id].readyToDrawStepLines=!0,o(t)},t.options.animation.duration),t.data.datasets.forEach(function(a,t){a.dummyStack&&(a.label="dummyStack_"+t,a.backgroundColor="rgba(0, 0, 0, 0)")})},afterDraw:function(a){a.options.plugins.waterFallPlugin.stepLines.enabled&&n[a.id].readyToDrawStepLines&&o(a)}}});
//# sourceMappingURL=chartjs-plugin-waterfall.min.js.map
